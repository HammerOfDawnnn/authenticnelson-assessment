<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AYA Questionnaire • Authentic Nelson</title>
<style>
  :root{
    --bg:#070707;
    --panel:rgba(255,255,255,.03);
    --edge:rgba(255,255,255,.12);
    --text:#d8d8d8;
    --muted:#a6a6a6;
    --accent:#b87333;
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
  .wrap{max-width:1020px;margin:auto;padding:14px}
  .bar{
    display:flex;gap:10px;flex-wrap:wrap;align-items:center;
    border:1px solid var(--edge);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border-radius:18px;padding:12px;box-shadow:0 18px 45px rgba(0,0,0,.30)
  }
  .left{margin-right:auto;color:var(--muted);font-size:12.5px}
  .pill{
    font-size:12px;color:var(--muted);
    border:1px solid rgba(255,255,255,.14);
    border-radius:999px;padding:6px 10px;background:rgba(255,255,255,.03);
  }
  button{
    appearance:none;border-radius:14px;border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.05);color:var(--text);padding:10px 12px;
    cursor:pointer;font-size:14px
  }
  button.primary{border-color:rgba(184,115,51,.62);background:rgba(184,115,51,.14)}
  button.primary:disabled{opacity:.45;cursor:not-allowed}
  button.ghost{background:rgba(255,255,255,.03)}
  button.danger{border-color:rgba(122,15,22,.55);background:rgba(122,15,22,.18)}
  .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
  .card{
    border:1px solid var(--edge);background:linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.02));
    border-radius:18px;padding:14px;box-shadow:0 18px 45px rgba(0,0,0,.25)
  }
  .k{display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
  .qnum{color:var(--muted);font-size:12px}
  .axis{color:rgba(184,115,51,.9);font-size:12px;border:1px solid rgba(184,115,51,.35);border-radius:999px;padding:3px 8px}
  .prompt{font-size:16px;line-height:1.25;margin:8px 0 10px}
  .opts{display:grid;grid-template-columns:1fr;gap:8px}
  .opt{
    border:1px solid rgba(255,255,255,.14);
    border-radius:14px;
    background:rgba(0,0,0,.25);
    padding:10px 12px;
    cursor:pointer;
    user-select:none;
    transition:transform .04s ease, border-color .15s ease, background .15s ease;
    font-size:14px;line-height:1.25
  }
  .opt:hover{transform:translateY(-1px);border-color:rgba(184,115,51,.35)}
  .opt.selected{border-color:rgba(184,115,51,.8);background:rgba(184,115,51,.10)}
  .opt small{display:block;color:var(--muted);margin-top:6px}
  .modalBack{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,.72);padding:14px;z-index:99
  }
  .modal{
    width:min(720px, 100%);
    border:1px solid rgba(255,255,255,.15);
    border-radius:18px;
    background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    box-shadow:0 22px 70px rgba(0,0,0,.55);
    padding:14px
  }
  .modalHead{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .modalTitle{font-size:14px;color:var(--muted);margin-right:auto}
  pre, textarea{
    width:100%;
    background:rgba(0,0,0,.30);
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px;
    color:var(--text);
    padding:12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size:12.5px;
    line-height:1.35;
  }
  textarea{min-height:120px;resize:vertical}
  pre{white-space:pre-wrap;margin:12px 0 0}
  .hidden{display:none}
  @media (max-width:520px){
    .prompt{font-size:15px}
    .bar{gap:8px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="bar">
    <div class="left" id="progress">0/10 answered</div>
    <div class="pill" id="statusPill">In progress</div>

    <button class="ghost" id="resetBtn" type="button">Reset</button>
    <button class="primary" id="finishBtn" type="button" disabled>Finish</button>

    <select id="exportFmt" class="hidden">
      <option value="txt">Export Summary .txt</option>
      <option value="doc">Export Summary .doc</option>
      <option value="pdf">Export Summary PDF</option>
    </select>
    <button id="exportBtn" class="hidden" type="button">Export</button>

    <button class="danger" id="wipeBtn" type="button">Wipe Device Save</button>
  </div>

  <div id="app" class="grid"></div>
</div>

<div class="modalBack" id="summaryBack" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="modalHead">
      <div class="modalTitle">Summary</div>
      <button class="ghost" id="copyCodeBtn" type="button">Copy Result Code</button>
      <button class="ghost" id="closeSummary" type="button">Close</button>
    </div>

    <pre id="summaryText"></pre>

    <div style="height:10px"></div>
    <div class="pill" style="display:inline-flex;gap:8px;align-items:center;">
      Result Code
    </div>
    <div style="height:10px"></div>
    <textarea id="resultCode" readonly></textarea>
  </div>
</div>

<script>
/* ============================================================
AYA TAKER (3 Levels)
- User selects Level 1/2/3 (language matures, not judgment)
- 10 questions, A–D scale maps to 1–4 points
- Generates:
  - brief summary (score + tier + coaching focus)
  - Result Code payload for mentor decoder
============================================================ */

const BUILD = "AYA_TAKER_v1.0";
const STORAGE_KEY = "AYA_TAKER_STATE_V1";

const LEVELS = {"LEVEL_1_BASE": [{"key": "q1", "prompt": "When I spoke today, how truthful was I?", "options": ["I knowingly altered, avoided, or distorted the truth to protect comfort, avoid tension, or maintain an image.", "I shared a partial version of the truth, filtering or softening it to manage reactions.", "I told the factual truth, though with hesitation, delay, or internal resistance.", "I spoke the truth clearly and calmly, without manipulation, concealment, or justification."]}, {"key": "q2", "prompt": "Did I withhold anything important to avoid consequences?", "options": ["I intentionally withheld key information to protect myself from discomfort or accountability.", "I minimized, postponed, or partially disclosed what mattered.", "I shared most of what was necessary, though not fully or confidently.", "I shared what was necessary and relevant, even when it created discomfort."]}, {"key": "q3", "prompt": "Was my tone aligned with how I actually felt?", "options": ["My tone was performative and did not reflect my internal state.", "My tone was controlled to fit expectations rather than truth.", "My tone was mostly honest, though restrained.", "My tone accurately reflected my internal state while remaining respectful."]}, {"key": "q4", "prompt": "Did my emotional responses come from sincerity?", "options": ["My response was strategic or designed to influence perception.", "My response was shaped by what felt socially acceptable.", "My response was sincere but limited by caution.", "My response was fully sincere, present, and grounded."]}, {"key": "q5", "prompt": "Was I present as myself or playing a role?", "options": ["I adopted a role to maintain safety, approval, or status.", "I adjusted who I was depending on the environment.", "I showed up mostly as myself, with minor self-editing.", "I showed up fully as myself, without distortion."]}, {"key": "q6", "prompt": "Did my decisions align with my values?", "options": ["I chose convenience over values.", "I compromised my values for short-term ease.", "I honored my values, though it felt uncomfortable.", "I acted in full alignment with my values."]}, {"key": "q7", "prompt": "Did my actions match my words?", "options": ["My actions contradicted what I said.", "My actions partially supported my words.", "My actions aligned, though inconsistently.", "My actions clearly reinforced my words."]}, {"key": "q8", "prompt": "Did I choose what was right for me or easiest to explain?", "options": ["I chose what others would accept.", "I chose what avoided conflict.", "I chose what felt right, with hesitation.", "I chose what was right for me, without apology."]}, {"key": "q9", "prompt": "Where was I today?", "options": ["I noticed clear misalignment between what I felt, said, and did.", "I was honest in facts but not fully genuine or authentic.", "I was genuine internally but inconsistent in action.", "I was aligned—honest, genuine, and authentic."]}, {"key": "q10", "prompt": "Would I respect myself if today repeated?", "options": ["No—repeating today would erode my self-respect.", "Some days yes, some days no.", "Yes, though growth is still required.", "Yes—I would trust and respect that version of myself."]}], "LEVEL_2_INTERMEDIATE": [{"key": "q1", "prompt": "When I spoke today, how aligned was my truth?", "options": ["I distorted or avoided truth to protect identity or outcome.", "I filtered truth to manage acceptance or perception.", "I expressed truth with caution or restraint.", "I expressed truth fully, without distortion or fear."]}, {"key": "q2", "prompt": "What motivated my silence, if any?", "options": ["Self-protection or fear of consequence.", "Image management or timing control.", "Discernment, though influenced by discomfort.", "Integrity and responsibility to truth."]}, {"key": "q3", "prompt": "Did my tone reflect my internal state?", "options": ["No—it was a mask.", "It was regulated for the environment.", "It was mostly congruent, with minor filtering.", "It was fully congruent and emotionally honest."]}, {"key": "q4", "prompt": "Where did my emotional responses originate?", "options": ["Strategy or self-preservation.", "External expectation.", "Sincerity with guarded expression.", "Grounded self-awareness and presence."]}, {"key": "q5", "prompt": "How consistently did I show up as myself?", "options": ["I performed a version of myself.", "I adapted myself to the room.", "I remained myself with boundaries.", "I remained myself without self-editing."]}, {"key": "q6", "prompt": "What governed my decisions?", "options": ["Ease and relief.", "Short-term comfort.", "Values, though with internal resistance.", "Values without compromise."]}, {"key": "q7", "prompt": "How congruent were my actions and words?", "options": ["They were misaligned.", "They were partially aligned.", "They aligned inconsistently.", "They aligned consistently and clearly."]}, {"key": "q8", "prompt": "What guided my choices?", "options": ["Approval and acceptance.", "Conflict avoidance.", "Inner truth with hesitation.", "Inner truth without justification."]}, {"key": "q9", "prompt": "Where did I land today?", "options": ["Fragmented alignment.", "Honesty without genuineness.", "Genuineness without consistency.", "Integrated alignment."]}, {"key": "q10", "prompt": "Would today’s version of me earn my trust?", "options": ["No.", "Occasionally.", "Mostly.", "Fully and consistently."]}], "LEVEL_3_ADVANCED": [{"key": "q1", "prompt": "When truth required courage, how did I respond?", "options": ["I avoided it.", "I diluted it.", "I expressed it carefully.", "I embodied it fully."]}, {"key": "q2", "prompt": "Was silence used as protection or principle?", "options": ["Protection from consequence.", "Preservation of image.", "Discernment with hesitation.", "Integrity rooted in values."]}, {"key": "q3", "prompt": "Did my tone honor my truth?", "options": ["No—masking occurred.", "Partial honesty.", "Mostly congruent.", "Fully congruent and grounded."]}, {"key": "q4", "prompt": "Were my emotions expressed with integrity?", "options": ["They were performative.", "They were externally shaped.", "They were internally honest but guarded.", "They were fully integrated and embodied."]}, {"key": "q5", "prompt": "Did I live as who I am—not who was required?", "options": ["I became who was needed.", "I adjusted to survive.", "I remained myself with limits.", "I remained myself without compromise."]}, {"key": "q6", "prompt": "Were my values non-negotiable today?", "options": ["No—they were conditional.", "Sometimes—they flexed under pressure.", "Mostly—they held with effort.", "Always—they governed my choices."]}, {"key": "q7", "prompt": "Did my actions prove my words?", "options": ["No—they contradicted them.", "In part—but not consistently.", "Inconsistently—but improving.", "Completely and repeatedly."]}, {"key": "q8", "prompt": "Did I choose alignment over explanation?", "options": ["No—explanation came first.", "Occasionally—when safe.", "With hesitation and internal debate.", "Without apology or defense."]}, {"key": "q9", "prompt": "How embodied was my authenticity today?", "options": ["Conceptual only.", "Situational.", "Practiced but not fully lived.", "Fully embodied."]}, {"key": "q10", "prompt": "If today became my identity, would I respect it?", "options": ["No—I would lose trust in myself.", "Sometimes—I would question it.", "Yes—with awareness of growth ahead.", "Yes—with full trust, respect, and ownership."]}]};

const LEVEL_META = {
  "LEVEL_1_BASE": { name: "Level 1 \u2014 Base (Honesty Awareness)" },
  "LEVEL_2_INTERMEDIATE": { name: "Level 2 \u2014 Intermediate (Genuineness Integration)" },
  "LEVEL_3_ADVANCED": { name: "Level 3 \u2014 Advanced (Authenticity Embodiment)" },
};

const TIERS = [[10, 19, "HONEST (FOUNDATIONAL)", "Where am I editing myself to stay safe?"], [20, 29, "GENUINE (INTEGRATED)", "What am I feeling that I’m not yet living?"], [30, 36, "AUTHENTIC (EMBODIED)", "Where does pressure test my integrity?"], [37, 40, "ELITE AUTHENTICITY", "How do I protect alignment as influence increases?"]];

// ---- RNG / Shuffle (kept for light randomization) ----
function mulberry32(a){
  return function(){
    let t=a+=0x6D2B79F5;
    t=Math.imul(t^(t>>>15),t|1);
    t^=t+Math.imul(t^(t>>>7),t|61);
    return ((t^(t>>>14))>>>0)/4294967296;
  }
}
function shuffle(arr,rng){
  const a=arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(rng()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

// ---- Base64url helpers ----
function b64urlEncode(obj){
  const json = JSON.stringify(obj);
  const b64 = btoa(unescape(encodeURIComponent(json)));
  return b64.replaceAll("+","-").replaceAll("/","_").replaceAll("=","");
}
function b64urlDecode(code){
  const b64 = code.trim().replaceAll("-","+").replaceAll("_","/");
  const pad = (b64.length % 4) ? "=".repeat(4 - (b64.length % 4)) : "";
  const raw = atob(b64 + pad);
  const json = decodeURIComponent(escape(raw));
  return JSON.parse(json);
}

// ---- State ----
let seed = null;
let rng = null;
let levelKey = null;
let QUESTIONS = [];
let ORDER = [];
let answers = {};            // key -> option text
let firstSeenAt = {};
let lastAnswerAt = {};
let timeSpentMs = {};
let chosenPos = {};
let answerChanges = 0;
let selectionLog = [];
let startedAt = Date.now();
let finishedAt = null;

// ---- DOM ----
const app = document.getElementById("app");
const progressEl = document.getElementById("progress");
const statusPill = document.getElementById("statusPill");
const resetBtn = document.getElementById("resetBtn");
const wipeBtn = document.getElementById("wipeBtn");
const finishBtn = document.getElementById("finishBtn");
const summaryBack = document.getElementById("summaryBack");
const summaryTextEl = document.getElementById("summaryText");
const resultCodeEl = document.getElementById("resultCode");
const copyCodeBtn = document.getElementById("copyCodeBtn");
const closeSummary = document.getElementById("closeSummary");

// ---- Persistence ----
function saveState(){
  const state = {
    seed, levelKey, answers, firstSeenAt, lastAnswerAt, timeSpentMs, chosenPos,
    answerChanges, selectionLog, startedAt, finishedAt
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return false;
    const s = JSON.parse(raw);
    seed = s.seed ?? null;
    levelKey = s.levelKey ?? null;
    answers = s.answers || {};
    firstSeenAt = s.firstSeenAt || {};
    lastAnswerAt = s.lastAnswerAt || {};
    timeSpentMs = s.timeSpentMs || {};
    chosenPos = s.chosenPos || {};
    answerChanges = Number(s.answerChanges || 0);
    selectionLog = s.selectionLog || [];
    startedAt = Number(s.startedAt || Date.now());
    finishedAt = s.finishedAt ?? null;
    return true;
  }catch(e){ return false; }
}
function wipeSave(){ localStorage.removeItem(STORAGE_KEY); }

// ---- Level gate ----
function openLevelGate(){
  const back = document.createElement("div");
  back.className = "modalBack";
  back.style.display = "flex";
  back.id = "levelGateBack";
  back.innerHTML = `
    <div class="modal">
      <div class="modalHead">
        <div class="modalTitle">Choose a level</div>
      </div>
      <pre style="margin:0">
Each level matures the language, not the judgment.

Pick the level that matches where you are today.
      </pre>
      <div style="height:12px"></div>
      <div class="row" style="gap:10px">
        <button class="primary" data-k="LEVEL_1_BASE">Level 1 — Base</button>
        <button class="primary" data-k="LEVEL_2_INTERMEDIATE">Level 2 — Intermediate</button>
        <button class="primary" data-k="LEVEL_3_ADVANCED">Level 3 — Advanced</button>
      </div>
      <div style="height:10px"></div>
      <div class="pill">A=1 • B=2 • C=3 • D=4</div>
    </div>`;
  document.body.appendChild(back);
  back.querySelectorAll("button[data-k]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      levelKey = btn.getAttribute("data-k");
      initForLevel(levelKey);
      saveState();
      back.remove();
      render();
    });
  });
}

// ---- Init ----
function initForLevel(k){
  QUESTIONS = (LEVELS[k] || []).map((q, idx)=>{
    const key = q.key || ("q"+(idx+1));
    const options = q.options.slice(0,4);
    const map = {
      [options[0]]:"A",
      [options[1]]:"B",
      [options[2]]:"C",
      [options[3]]:"D"
    };
    return { key, prompt:q.prompt, options, map };
  });

  // init order deterministically but stable across reload
  if(seed == null) seed = Date.now() ^ (Math.random()*1e9|0);
  rng = mulberry32(seed);
  ORDER = shuffle(QUESTIONS, rng);

  // ensure firstSeenAt keys exist
  const now = Date.now();
  ORDER.forEach(q=>{ if(firstSeenAt[q.key] == null) firstSeenAt[q.key] = now; });
}

function answeredCount(){ return ORDER.filter(q=>answers[q.key]).length; }
function allAnswered(){ return answeredCount() === ORDER.length; }

function ensureFirstSeen(){
  const now = Date.now();
  ORDER.forEach(q=>{ if(firstSeenAt[q.key] == null) firstSeenAt[q.key] = now; });
}

function render(){
  if(!levelKey){
    progressEl.textContent = `0/10 answered`;
    statusPill.textContent = "Choose level";
    finishBtn.disabled = true;
    app.innerHTML = "";
    openLevelGate();
    return;
  }

  ensureFirstSeen();

  const done = answeredCount();
  progressEl.textContent = `${done}/${ORDER.length} answered • ${LEVEL_META[levelKey]?.name || levelKey}`;
  statusPill.textContent = allAnswered() ? "Ready" : "In progress";
  finishBtn.disabled = !allAnswered();

  app.innerHTML = "";
  ORDER.forEach((q, idx)=>{
    const card = document.createElement("div");
    card.className = "card";

    const head = document.createElement("div");
    head.className = "k";
    head.innerHTML = `<div class="qnum">Q${idx+1}</div>`;
    card.appendChild(head);

    const prompt = document.createElement("div");
    prompt.className = "prompt";
    prompt.textContent = q.prompt;
    card.appendChild(prompt);

    const opts = document.createElement("div");
    opts.className = "opts";

    q.options.forEach((optText, optIdx)=>{
      const opt = document.createElement("div");
      opt.className = "opt" + ((answers[q.key] === optText) ? " selected" : "");
      opt.textContent = optText;
      opt.addEventListener("click", ()=>selectOption(q, optText, optIdx+1));
      opts.appendChild(opt);
    });

    card.appendChild(opts);
    app.appendChild(card);
  });
}

function selectOption(q, optText, pos){
  const now = Date.now();

  const last = lastAnswerAt[q.key] ?? firstSeenAt[q.key] ?? now;
  const delta = Math.max(0, now - last);
  timeSpentMs[q.key] = (timeSpentMs[q.key] || 0) + delta;

  if(answers[q.key] && answers[q.key] !== optText) answerChanges++;

  answers[q.key] = optText;
  chosenPos[q.key] = pos;
  lastAnswerAt[q.key] = now;

  selectionLog.push({ t: now, k: q.key, p: pos, ch: answerChanges });
  if(selectionLog.length > 220) selectionLog = selectionLog.slice(-220);

  saveState();
  render();
}

function computeScore(){
  // score is sum of selected option positions (A=1..D=4) in display order
  return ORDER.reduce((s,q)=>{
    const pos = chosenPos[q.key] || 0;
    return s + pos;
  }, 0);
}

function tierFor(score){
  for(const [min,max,label,focus] of TIERS){
    if(score>=min && score<=max) return {min,max,label,focus};
  }
  return {min:null,max:null,label:"UNSCORED",focus:""};
}

function buildSummaryPlain(){
  const score = computeScore();
  const tier = tierFor(score);
  const lines = [];
  lines.push("Summary");
  lines.push("");
  lines.push(LEVEL_META[levelKey]?.name || levelKey);
  lines.push(`Score: ${score} / 40`);
  lines.push(`Tier: ${tier.label}`);
  lines.push("");
  lines.push("Coaching Focus:");
  lines.push(`“${tier.focus}”`);
  lines.push("");
  lines.push("Mentor note: share the Result Code below to unlock the full breakdown.");
  return lines.join("\n");
}

function finalizePayload(){
  finishedAt = Date.now();

  const perQ = ORDER.map(q=>{
    const ms = timeSpentMs[q.key] || 0;
    return { key: q.key, pos: chosenPos[q.key] || null, ms };
  });
  const totalActiveMs = perQ.reduce((s,x)=>s + (x.ms||0), 0);

  const codes = ORDER.map(q=>{
    const sel = answers[q.key];
    return sel ? q.map[sel] : null;
  });

  const payload = {
    v: BUILD,
    seed,
    levelKey,
    score: computeScore(),
    tier: tierFor(computeScore()),
    orderKeys: ORDER.map(q=>q.key),
    answers,
    codes,
    telem: {
      startedAt,
      finishedAt,
      totalActiveMs,
      perQ,
      answerChanges,
      selectionEvents: selectionLog.slice(-200)
    }
  };
  return payload;
}

// ---- Modal ----
function openSummary(){ summaryBack.style.display="flex"; }
function closeSummaryModal(){ summaryBack.style.display="none"; }
closeSummary.addEventListener("click", closeSummaryModal);
summaryBack.addEventListener("click", (e)=>{ if(e.target===summaryBack) closeSummaryModal(); });

// ---- Buttons ----
resetBtn.addEventListener("click", ()=>{
  if(!confirm("Reset all answers?")) return;
  answers = {};
  firstSeenAt = {};
  lastAnswerAt = {};
  timeSpentMs = {};
  chosenPos = {};
  answerChanges = 0;
  selectionLog = [];
  startedAt = Date.now();
  finishedAt = null;
  summaryTextEl.textContent = "";
  resultCodeEl.value = "";
  initForLevel(levelKey);
  saveState();
  render();
});

wipeBtn.addEventListener("click", ()=>{
  if(!confirm("Wipe saved state on this device?")) return;
  wipeSave();
  seed = null;
  levelKey = null;
  answers = {};
  firstSeenAt = {};
  lastAnswerAt = {};
  timeSpentMs = {};
  chosenPos = {};
  answerChanges = 0;
  selectionLog = [];
  startedAt = Date.now();
  finishedAt = null;
  summaryTextEl.textContent = "";
  resultCodeEl.value = "";
  render();
});

finishBtn.addEventListener("click", ()=>{
  if(!allAnswered()){ alert("Answer all questions first."); return; }
  const summary = buildSummaryPlain();
  summaryTextEl.textContent = summary;

  const payload = finalizePayload();
  const code = b64urlEncode(payload);
  resultCodeEl.value = code;

  saveState();
  openSummary();
});

copyCodeBtn.addEventListener("click", async ()=>{
  const code = (resultCodeEl.value || "").trim();
  if(!code){ alert("No result code yet."); return; }
  try{
    await navigator.clipboard.writeText(code);
    alert("Copied.");
  }catch(e){
    prompt("Copy this:", code);
  }
});

// ---- Boot ----
const loaded = loadState();
if(levelKey) initForLevel(levelKey);
render();
</script>
</body>
</html>

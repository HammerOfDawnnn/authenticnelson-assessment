<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AYA Questionnaire — Begin</title>
<style>
  :root {
    --bg: #070707;
    --panel: rgba(255,255,255,.05);
    --edge: rgba(255,255,255,.12);
    --text: #e8e8e8;
    --muted:#b8b8b8;
    --accent:#b87333;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:28px 18px 80px;}
  .topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:18px;}
  .pill{border:1px solid var(--edge);background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); padding:10px 12px;border-radius:999px;display:flex;gap:10px;align-items:center;}
  .pill small{color:var(--muted)}
  .btn{border:1px solid var(--edge);background:rgba(255,255,255,.04);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;}
  .btn:hover{border-color:rgba(255,255,255,.25)}
  .btn.accent{border-color:rgba(184,115,51,.55);}
  .btn.danger{border-color:rgba(255,70,70,.6);}
  h1{font-size:28px;line-height:1.15;margin:12px 0 10px;}
  p.lead{color:var(--muted);margin:0 0 18px;}
  .card{border:1px solid var(--edge);background:var(--panel);border-radius:18px;padding:18px;margin:14px 0;}
  .grid{display:grid;grid-template-columns:1fr;gap:12px;}
  @media (min-width:900px){ .grid{grid-template-columns:1fr 1fr;} }
  .lvl{padding:16px;border-radius:16px;border:1px solid var(--edge);background:rgba(255,255,255,.03);cursor:pointer;}
  .lvl:hover{border-color:rgba(184,115,51,.55)}
  .lvl .name{font-weight:700}
  .lvl .desc{color:var(--muted);margin-top:8px;font-size:13px;line-height:1.35}
  .q{padding:14px;border-radius:16px;border:1px solid var(--edge);background:rgba(0,0,0,.15);}
  .q h3{margin:0 0 12px;font-size:16px;line-height:1.3}
  .opt{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);margin:8px 0;}
  .opt input{margin-top:4px}
  .opt span{color:var(--text);font-size:14px;line-height:1.35}
  .muted{color:var(--muted)}
  .codebox{width:100%;min-height:88px;border-radius:14px;border:1px solid var(--edge);background:rgba(0,0,0,.25);color:var(--text);padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .hidden{display:none!important}
  .hr{height:1px;background:rgba(255,255,255,.08);margin:16px 0}
  .footnote{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="pill">
      <div><strong id="progress">0/0 answered</strong><br><small id="status" class="muted">Choose a level</small></div>
    </div>
    <div class="row">
      <button class="btn" id="resetBtn" title="Clears answers for the current level">Reset</button>
      <button class="btn" id="finishBtn">Finish</button>
      <button class="btn danger" id="wipeBtn" title="Clears all saved assessment data on this device">Wipe Device Save</button>
    </div>
  </div>

  <h1>AYA Questionnaire</h1>
  <p class="lead">Select a level. Complete it. You’ll get a brief summary and a mentor code.</p>

  <div id="levelPicker" class="card">
    <div class="grid" id="levels"></div>
    <div class="footnote" style="margin-top:10px;">
      Note: progress is saved in this browser. If you switch devices/browsers, it won’t follow you.
    </div>
  </div>

  <div id="questionArea" class="card hidden">
    <div class="row" style="justify-content:space-between;">
      <div>
        <div style="font-weight:800" id="levelTitle"></div>
        <div class="muted" style="margin-top:4px;font-size:13px;" id="levelDesc"></div>
      </div>
      <button class="btn accent" id="changeLevelBtn">Change Level</button>
    </div>
    <div class="hr"></div>
    <div id="questions"></div>
  </div>

  <div id="resultsArea" class="card hidden">
    <div style="font-weight:900;font-size:18px;">Complete.</div>
    <p class="muted" style="margin:8px 0 14px;">This is your brief summary. Your mentor code is below.</p>

    <div id="brief" class="muted"></div>

    <div class="hr"></div>
    <div style="font-weight:800;margin-bottom:8px;">Mentor Code</div>
    <textarea id="codeOut" class="codebox" readonly></textarea>
    <div class="row" style="margin-top:10px;">
      <button class="btn" id="copyBtn">Copy Code</button>
      <a class="btn accent" id="mentorLink" href="mentor.html" target="_blank" rel="noopener">Open Mentor Page</a>
    </div>
    <div class="footnote" style="margin-top:10px;">
      The mentor code contains your selected answers (no name unless you add it yourself).
    </div>
  </div>
</div>

<script>
const LEVELS = [{"id": "LEVEL_1_BASE", "label": "Level 1 — Base", "description": "Honesty Awareness | Conscious Recognition Focus: Truth vs avoidance in daily behavior", "questions": [{"key": "q1", "prompt": "When I spoke today, how truthful was I?", "options": ["I knowingly altered, avoided, or distorted the truth to protect comfort, avoid tension, or maintain an image.", "I shared a partial version of the truth, filtering or softening it to manage reactions.", "I told the factual truth, though with hesitation, delay, or internal resistance.", "I spoke the truth clearly and calmly, without manipulation, concealment, or justification."]}, {"key": "q2", "prompt": "Did I withhold anything important to avoid consequences?", "options": ["I intentionally withheld key information to protect myself from discomfort or accountability.", "I minimized, postponed, or partially disclosed what mattered.", "I shared most of what was necessary, though not fully or confidently.", "I shared what was necessary and relevant, even when it created discomfort."]}, {"key": "q3", "prompt": "Was my tone aligned with how I actually felt?", "options": ["My tone was performative and did not reflect my internal state.", "My tone was controlled to fit expectations rather than truth.", "My tone was mostly honest, though restrained.", "My tone accurately reflected my internal state while remaining respectful."]}, {"key": "q4", "prompt": "Did my emotional responses come from sincerity?", "options": ["My response was strategic or designed to influence perception.", "My response was shaped by what felt socially acceptable.", "My response was sincere but limited by caution.", "My response was fully sincere, present, and grounded."]}, {"key": "q5", "prompt": "Was I present as myself or playing a role?", "options": ["I adopted a role to maintain safety, approval, or status.", "I adjusted who I was depending on the environment.", "I showed up mostly as myself, with minor self-editing.", "I showed up fully as myself, without distortion."]}, {"key": "q6", "prompt": "Did my decisions align with my values?", "options": ["I chose convenience over values.", "I compromised my values for short-term ease.", "I honored my values, though it felt uncomfortable.", "I acted in full alignment with my values."]}, {"key": "q7", "prompt": "Did my actions match my words?", "options": ["My actions contradicted what I said.", "My actions partially supported my words.", "My actions aligned, though inconsistently.", "My actions clearly reinforced my words."]}, {"key": "q8", "prompt": "Did I choose what was right for me or easiest to explain?", "options": ["I chose what others would accept.", "I chose what avoided conflict.", "I chose what felt right, with hesitation.", "I chose what was right for me, without apology."]}, {"key": "q9", "prompt": "Where was I today?", "options": ["I noticed clear misalignment between what I felt, said, and did.", "I was honest in facts but not fully genuine or authentic.", "I was genuine internally but inconsistent in action.", "I was aligned—honest, genuine, and authentic."]}, {"key": "q10", "prompt": "Would I respect myself if today repeated?", "options": ["No—repeating today would erode my self-respect.", "Some days yes, some days no.", "Yes, though growth is still required.", "Yes—I would trust and respect that version of myself."]}]}, {"id": "LEVEL_3_ARCHITECT", "label": "Level 3 — The Architect", "description": "Genuineness Integration | Emotional Congruence Focus: Alignment between inner state and outward behavior", "questions": [{"key": "q1", "prompt": "When I spoke today, how aligned was my truth?", "options": ["I distorted or avoided truth to protect identity or outcome.", "I filtered truth to manage acceptance or perception.", "I expressed truth with caution or restraint.", "I expressed truth fully, without distortion or fear."]}, {"key": "q2", "prompt": "What motivated my silence, if any?", "options": ["Self-protection or fear of consequence.", "Image management or timing control.", "Discernment, though influenced by discomfort.", "Integrity and responsibility to truth."]}, {"key": "q3", "prompt": "Did my tone reflect my internal state?", "options": ["No—it was a mask.", "It was regulated for the environment.", "It was mostly congruent, with minor filtering.", "It was fully congruent and emotionally honest."]}, {"key": "q4", "prompt": "Where did my emotional responses originate?", "options": ["Strategy or self-preservation.", "External expectation.", "Sincerity with guarded expression.", "Grounded self-awareness and presence."]}, {"key": "q5", "prompt": "How consistently did I show up as myself?", "options": ["I performed a version of myself.", "I adapted myself to the room.", "I remained myself with boundaries.", "I remained myself without self-editing."]}, {"key": "q6", "prompt": "What governed my decisions?", "options": ["Ease and relief.", "Short-term comfort.", "Values, though with internal resistance.", "Values without compromise."]}, {"key": "q7", "prompt": "How congruent were my actions and words?", "options": ["They were misaligned.", "They were partially aligned.", "They aligned inconsistently.", "They aligned consistently and clearly."]}, {"key": "q8", "prompt": "What guided my choices?", "options": ["Approval and acceptance.", "Conflict avoidance.", "Inner truth with hesitation.", "Inner truth without justification."]}, {"key": "q9", "prompt": "Where did I land today?", "options": ["Fragmented alignment.", "Honesty without genuineness.", "Genuineness without consistency.", "Integrated alignment."]}, {"key": "q10", "prompt": "Would today’s version of me earn my trust?", "options": ["No.", "Occasionally.", "Mostly.", "Fully and consistently."]}]}, {"id": "LEVEL_3_ARCHITECT", "label": "Level 3 — The Architect", "description": "Authenticity Embodiment | Identity Integrity Focus: Lived alignment as identity", "questions": [{"key": "q1", "prompt": "When truth required courage, how did I respond?", "options": ["I avoided it.", "I diluted it.", "I expressed it carefully.", "I embodied it fully."]}, {"key": "q2", "prompt": "Was silence used as protection or principle?", "options": ["Protection from consequence.", "Preservation of image.", "Discernment with hesitation.", "Integrity rooted in values."]}, {"key": "q3", "prompt": "Did my tone honor my truth?", "options": ["No—masking occurred.", "Partial honesty.", "Mostly congruent.", "Fully congruent and grounded."]}, {"key": "q4", "prompt": "Were my emotions expressed with integrity?", "options": ["They were performative.", "They were externally shaped.", "They were internally honest but guarded.", "They were fully integrated and embodied."]}, {"key": "q5", "prompt": "Did I live as who I am—not who was required?", "options": ["I became who was needed.", "I adjusted to survive.", "I remained myself with limits.", "I remained myself without compromise."]}, {"key": "q6", "prompt": "Were my values non-negotiable today?", "options": ["No—they were conditional.", "Sometimes—they flexed under pressure.", "Mostly—they held with effort.", "Always—they governed my choices."]}, {"key": "q7", "prompt": "Did my actions prove my words?", "options": ["No—they contradicted them.", "In part—but not consistently.", "Inconsistently—but improving.", "Completely and repeatedly."]}, {"key": "q8", "prompt": "Did I choose alignment over explanation?", "options": ["No—explanation came first.", "Occasionally—when safe.", "With hesitation and internal debate.", "Without apology or defense."]}, {"key": "q9", "prompt": "How embodied was my authenticity today?", "options": ["Conceptual only.", "Situational.", "Practiced but not fully lived.", "Fully embodied."]}, {"key": "q10", "prompt": "If today became my identity, would I respect it?", "options": ["No—I would lose trust in myself.", "Sometimes—I would question it.", "Yes—with awareness of growth ahead.", "Yes—with full trust, respect, and ownership."]}]}];
const STORAGE_KEY = "aya_assessment_v1";

function loadState() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
  } catch(e) { return {}; }
}
function saveState(state) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function wipeAll() {
  localStorage.removeItem(STORAGE_KEY);
}

function setStatus(txt) {
  document.getElementById("status").textContent = txt;
}

let activeLevelId = null;

function renderLevels() {
  const wrap = document.getElementById("levels");
  wrap.innerHTML = "";
  LEVELS.forEach(lvl => {
    const d = document.createElement("div");
    d.className = "lvl";
    d.innerHTML = `<div class="name">${lvl.label}</div><div class="desc">${escapeHtml(lvl.description || "")}</div>`;
    d.addEventListener("click", () => selectLevel(lvl.id));
    wrap.appendChild(d);
  });
}

function escapeHtml(s) {
  return (s||"").replace(/[&<>"]/g, c => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
}

function getLevel(id) {
  return LEVELS.find(l => l.id === id);
}

function getAnswers(levelId) {
  const st = loadState();
  return (st[levelId] && st[levelId].answers) ? st[levelId].answers : {};
}

function setAnswer(levelId, qKey, optIndex) {
  const st = loadState();
  st[levelId] = st[levelId] || {};
  st[levelId].answers = st[levelId].answers || {};
  st[levelId].answers[qKey] = optIndex;
  saveState(st);
}

function clearLevel(levelId) {
  const st = loadState();
  if (st[levelId]) {
    delete st[levelId];
    saveState(st);
  }
}

function updateProgress() {
  const lvl = getLevel(activeLevelId);
  if (!lvl) {
    document.getElementById("progress").textContent = "0/0 answered";
    return;
  }
  const answers = getAnswers(activeLevelId);
  const answered = Object.keys(answers).length;
  document.getElementById("progress").textContent = `${answered}/${lvl.questions.length} answered`;
  setStatus(answered === lvl.questions.length ? "Ready to finish" : "In progress");
}

function selectLevel(levelId) {
  activeLevelId = levelId;
  document.getElementById("levelPicker").classList.add("hidden");
  document.getElementById("resultsArea").classList.add("hidden");
  document.getElementById("questionArea").classList.remove("hidden");

  const lvl = getLevel(levelId);
  document.getElementById("levelTitle").textContent = lvl.label;
  document.getElementById("levelDesc").textContent = lvl.description || "";

  renderQuestions();
  updateProgress();
}

function renderQuestions() {
  const lvl = getLevel(activeLevelId);
  const answers = getAnswers(activeLevelId);
  const container = document.getElementById("questions");
  container.innerHTML = "";

  lvl.questions.forEach((q, qi) => {
    const qDiv = document.createElement("div");
    qDiv.className = "q";
    const title = document.createElement("h3");
    title.textContent = `${qi+1}. ${q.prompt}`;
    qDiv.appendChild(title);

    q.options.forEach((opt, oi) => {
      const lbl = document.createElement("label");
      lbl.className = "opt";
      const inp = document.createElement("input");
      inp.type = "radio";
      inp.name = q.key;
      inp.value = oi;
      if (answers[q.key] === oi) inp.checked = true;
      inp.addEventListener("change", () => {
        setAnswer(activeLevelId, q.key, oi);
        updateProgress();
      });
      const sp = document.createElement("span");
      sp.textContent = opt;
      lbl.appendChild(inp);
      lbl.appendChild(sp);
      qDiv.appendChild(lbl);
    });

    container.appendChild(qDiv);
  });
}

function buildMentorPayload() {
  const lvl = getLevel(activeLevelId);
  const answers = getAnswers(activeLevelId);

  const answeredCount = Object.keys(answers).length;
  if (answeredCount !== lvl.questions.length) {
    return { ok:false, error:`You still have ${lvl.questions.length - answeredCount} unanswered.` };
  }

  const selections = lvl.questions.map(q => {
    const idx = answers[q.key];
    return {
      key: q.key,
      prompt: q.prompt,
      optionIndex: idx,
      optionText: q.options[idx],
      optionLetter: ["A","B","C","D"][idx] || "?"
    };
  });

  const payload = {
    v: 1,
    createdAt: new Date().toISOString(),
    level: { id: lvl.id, label: lvl.label },
    selections
  };

  // base64url
  const jsonStr = JSON.stringify(payload);
  const b64 = btoa(unescape(encodeURIComponent(jsonStr))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
  return { ok:true, payload, code: b64 };
}

function showResults() {
  const res = buildMentorPayload();
  if (!res.ok) {
    alert(res.error);
    return;
  }

  document.getElementById("questionArea").classList.add("hidden");
  document.getElementById("levelPicker").classList.add("hidden");
  document.getElementById("resultsArea").classList.remove("hidden");

  // brief summary
  const brief = document.getElementById("brief");
  brief.innerHTML = "";
  const p1 = document.createElement("div");
  p1.innerHTML = `<strong>${escapeHtml(res.payload.level.label)}</strong> — completed.`;
  brief.appendChild(p1);

  const ul = document.createElement("ul");
  ul.className = "muted";
  ul.style.marginTop = "10px";
  res.payload.selections.forEach((s, i) => {
    const li = document.createElement("li");
    li.textContent = `${i+1}) ${s.optionLetter} — ${s.optionText}`;
    ul.appendChild(li);
  });
  brief.appendChild(ul);

  const codeOut = document.getElementById("codeOut");
  codeOut.value = res.code;

  // Mentor link with code prefill
  const mentorLink = document.getElementById("mentorLink");
  mentorLink.href = `mentor.html#code=${encodeURIComponent(res.code)}`;
}

document.getElementById("finishBtn").addEventListener("click", showResults);

document.getElementById("copyBtn").addEventListener("click", () => {
  const t = document.getElementById("codeOut");
  t.select();
  document.execCommand("copy");
});

document.getElementById("resetBtn").addEventListener("click", () => {
  if (!activeLevelId) return;
  if (!confirm("Reset answers for the current level?")) return;
  clearLevel(activeLevelId);
  renderQuestions();
  updateProgress();
});

document.getElementById("wipeBtn").addEventListener("click", () => {
  if (!confirm("Wipe ALL saved data for this assessment on this device?")) return;
  wipeAll();
  activeLevelId = null;
  document.getElementById("questionArea").classList.add("hidden");
  document.getElementById("resultsArea").classList.add("hidden");
  document.getElementById("levelPicker").classList.remove("hidden");
  updateProgress();
  setStatus("Choose a level");
});

document.getElementById("changeLevelBtn").addEventListener("click", () => {
  activeLevelId = null;
  document.getElementById("questionArea").classList.add("hidden");
  document.getElementById("resultsArea").classList.add("hidden");
  document.getElementById("levelPicker").classList.remove("hidden");
  updateProgress();
  setStatus("Choose a level");
});

renderLevels();
updateProgress();
</script>
</body>
</html>

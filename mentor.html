<!-- =========================================================
FILE 2: FSM_MENTOR_DECODER.html (COMPACT RESULT CODE SUPPORT)
- Mentor pastes Result Code from taker file
- Produces full detailed report
- Supports BOTH:
  - New compact payload (v/s/ok/c/ai/t)
  - Old payload (v/seed/orderKeys/codes/answers/telem)
========================================================= -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AYA Mentor Decoder • Authentic Nelson</title>
<style>
  :root{
    --bg:#050506;
    --panel:rgba(255,255,255,.035);
    --edge:rgba(255,255,255,.12);
    --text:#e3e3e6;
    --muted:rgba(227,227,230,.72);
    --silver:#c8c8cd;
    --copper:#b87333;
    --red:#7a0f16;
  }
  body{
    margin:0;
    background:
      radial-gradient(1100px 650px at 20% 0%, rgba(184,115,51,.10), transparent 55%),
      radial-gradient(900px 600px at 100% 0%, rgba(122,15,22,.10), transparent 50%),
      var(--bg);
    color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .card{
    border:1px solid var(--edge);
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border-radius:18px;
    padding:14px;
    box-shadow: 0 18px 45px rgba(0,0,0,.30);
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .pill{
    font-size:12px;color:var(--muted);
    border:1px solid rgba(255,255,255,.14);
    border-radius:999px;padding:6px 10px;background:rgba(255,255,255,.03);
  }
  textarea{
    width:100%;
    min-height:120px;
    resize:vertical;
    background:rgba(0,0,0,.25);
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px;
    color:var(--text);
    padding:12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size:12.5px;
    line-height:1.35;
  }
  button{
    appearance:none;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.045);
    color:var(--text);
    padding:10px 12px;
    cursor:pointer;
    font-size:14px;
  }
  button.primary{
    border-color:rgba(184,115,51,.62);
    background:rgba(184,115,51,.14);
  }
  pre{
    white-space:pre-wrap;
    background:rgba(0,0,0,.30);
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px;
    padding:14px;
    margin:14px 0 0;
    color:var(--text);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size:12.5px;
    line-height:1.35;
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div class="pill">Mentor Decoder</div>
      <button class="primary" id="decodeBtn" type="button">Decode</button>
      <button id="copyBtn" type="button">Copy Report</button>
      <button id="clearBtn" type="button">Clear</button>
    </div>
    <div style="height:10px"></div>
    <textarea id="codeIn" placeholder="Paste Result Code here..."></textarea>
    <pre id="out"></pre>
  </div>
</div>

<script>
/* ============================================================
AYA MENTOR DECODER
============================================================ */

const LEVELS = {"LEVEL_1_BASE": [{"key": "q1", "prompt": "When I spoke today, how truthful was I?", "options": ["I knowingly altered, avoided, or distorted the truth to protect comfort, avoid tension, or maintain an image.", "I shared a partial version of the truth, filtering or softening it to manage reactions.", "I told the factual truth, though with hesitation, delay, or internal resistance.", "I spoke the truth clearly and calmly, without manipulation, concealment, or justification."]}, {"key": "q2", "prompt": "Did I withhold anything important to avoid consequences?", "options": ["I intentionally withheld key information to protect myself from discomfort or accountability.", "I minimized, postponed, or partially disclosed what mattered.", "I shared most of what was necessary, though not fully or confidently.", "I shared what was necessary and relevant, even when it created discomfort."]}, {"key": "q3", "prompt": "Was my tone aligned with how I actually felt?", "options": ["My tone was performative and did not reflect my internal state.", "My tone was controlled to fit expectations rather than truth.", "My tone was mostly honest, though restrained.", "My tone accurately reflected my internal state while remaining respectful."]}, {"key": "q4", "prompt": "Did my emotional responses come from sincerity?", "options": ["My response was strategic or designed to influence perception.", "My response was shaped by what felt socially acceptable.", "My response was sincere but limited by caution.", "My response was fully sincere, present, and grounded."]}, {"key": "q5", "prompt": "Was I present as myself or playing a role?", "options": ["I adopted a role to maintain safety, approval, or status.", "I adjusted who I was depending on the environment.", "I showed up mostly as myself, with minor self-editing.", "I showed up fully as myself, without distortion."]}, {"key": "q6", "prompt": "Did my decisions align with my values?", "options": ["I chose convenience over values.", "I compromised my values for short-term ease.", "I honored my values, though it felt uncomfortable.", "I acted in full alignment with my values."]}, {"key": "q7", "prompt": "Did my actions match my words?", "options": ["My actions contradicted what I said.", "My actions partially supported my words.", "My actions aligned, though inconsistently.", "My actions clearly reinforced my words."]}, {"key": "q8", "prompt": "Did I choose what was right for me or easiest to explain?", "options": ["I chose what others would accept.", "I chose what avoided conflict.", "I chose what felt right, with hesitation.", "I chose what was right for me, without apology."]}, {"key": "q9", "prompt": "Where was I today?", "options": ["I noticed clear misalignment between what I felt, said, and did.", "I was honest in facts but not fully genuine or authentic.", "I was genuine internally but inconsistent in action.", "I was aligned—honest, genuine, and authentic."]}, {"key": "q10", "prompt": "Would I respect myself if today repeated?", "options": ["No—repeating today would erode my self-respect.", "Some days yes, some days no.", "Yes, though growth is still required.", "Yes—I would trust and respect that version of myself."]}], "LEVEL_2_INTERMEDIATE": [{"key": "q1", "prompt": "When I spoke today, how aligned was my truth?", "options": ["I distorted or avoided truth to protect identity or outcome.", "I filtered truth to manage acceptance or perception.", "I expressed truth with caution or restraint.", "I expressed truth fully, without distortion or fear."]}, {"key": "q2", "prompt": "What motivated my silence, if any?", "options": ["Self-protection or fear of consequence.", "Image management or timing control.", "Discernment, though influenced by discomfort.", "Integrity and responsibility to truth."]}, {"key": "q3", "prompt": "Did my tone reflect my internal state?", "options": ["No—it was a mask.", "It was regulated for the environment.", "It was mostly congruent, with minor filtering.", "It was fully congruent and emotionally honest."]}, {"key": "q4", "prompt": "Where did my emotional responses originate?", "options": ["Strategy or self-preservation.", "External expectation.", "Sincerity with guarded expression.", "Grounded self-awareness and presence."]}, {"key": "q5", "prompt": "How consistently did I show up as myself?", "options": ["I performed a version of myself.", "I adapted myself to the room.", "I remained myself with boundaries.", "I remained myself without self-editing."]}, {"key": "q6", "prompt": "What governed my decisions?", "options": ["Ease and relief.", "Short-term comfort.", "Values, though with internal resistance.", "Values without compromise."]}, {"key": "q7", "prompt": "How congruent were my actions and words?", "options": ["They were misaligned.", "They were partially aligned.", "They aligned inconsistently.", "They aligned consistently and clearly."]}, {"key": "q8", "prompt": "What guided my choices?", "options": ["Approval and acceptance.", "Conflict avoidance.", "Inner truth with hesitation.", "Inner truth without justification."]}, {"key": "q9", "prompt": "Where did I land today?", "options": ["Fragmented alignment.", "Honesty without genuineness.", "Genuineness without consistency.", "Integrated alignment."]}, {"key": "q10", "prompt": "Would today’s version of me earn my trust?", "options": ["No.", "Occasionally.", "Mostly.", "Fully and consistently."]}], "LEVEL_3_ADVANCED": [{"key": "q1", "prompt": "When truth required courage, how did I respond?", "options": ["I avoided it.", "I diluted it.", "I expressed it carefully.", "I embodied it fully."]}, {"key": "q2", "prompt": "Was silence used as protection or principle?", "options": ["Protection from consequence.", "Preservation of image.", "Discernment with hesitation.", "Integrity rooted in values."]}, {"key": "q3", "prompt": "Did my tone honor my truth?", "options": ["No—masking occurred.", "Partial honesty.", "Mostly congruent.", "Fully congruent and grounded."]}, {"key": "q4", "prompt": "Were my emotions expressed with integrity?", "options": ["They were performative.", "They were externally shaped.", "They were internally honest but guarded.", "They were fully integrated and embodied."]}, {"key": "q5", "prompt": "Did I live as who I am—not who was required?", "options": ["I became who was needed.", "I adjusted to survive.", "I remained myself with limits.", "I remained myself without compromise."]}, {"key": "q6", "prompt": "Were my values non-negotiable today?", "options": ["No—they were conditional.", "Sometimes—they flexed under pressure.", "Mostly—they held with effort.", "Always—they governed my choices."]}, {"key": "q7", "prompt": "Did my actions prove my words?", "options": ["No—they contradicted them.", "In part—but not consistently.", "Inconsistently—but improving.", "Completely and repeatedly."]}, {"key": "q8", "prompt": "Did I choose alignment over explanation?", "options": ["No—explanation came first.", "Occasionally—when safe.", "With hesitation and internal debate.", "Without apology or defense."]}, {"key": "q9", "prompt": "How embodied was my authenticity today?", "options": ["Conceptual only.", "Situational.", "Practiced but not fully lived.", "Fully embodied."]}, {"key": "q10", "prompt": "If today became my identity, would I respect it?", "options": ["No—I would lose trust in myself.", "Sometimes—I would question it.", "Yes—with awareness of growth ahead.", "Yes—with full trust, respect, and ownership."]}]};
const LEVEL_META = {
  "LEVEL_1_BASE": { name: "Level 1 \u2014 Base (Honesty Awareness)" },
  "LEVEL_2_INTERMEDIATE": { name: "Level 2 \u2014 Intermediate (Genuineness Integration)" },
  "LEVEL_3_ADVANCED": { name: "Level 3 \u2014 Advanced (Authenticity Embodiment)" }
};
const TIERS = [[10, 19, "HONEST (FOUNDATIONAL)", "Where am I editing myself to stay safe?"], [20, 29, "GENUINE (INTEGRATED)", "What am I feeling that I’m not yet living?"], [30, 36, "AUTHENTIC (EMBODIED)", "Where does pressure test my integrity?"], [37, 40, "ELITE AUTHENTICITY", "How do I protect alignment as influence increases?"]];

function tierFor(score){
  for(const [min,max,label,focus] of TIERS){
    if(score>=min && score<=max) return {min,max,label,focus};
  }
  return {min:null,max:null,label:"UNSCORED",focus:""};
}

function msToPretty(ms){
  const s=Math.round(ms/1000);
  const m=Math.floor(s/60);
  const r=s%60;
  return m>0 ? `${m}m ${r}s` : `${r}s`;
}

function b64urlDecode(code){
  const b64 = code.trim().replaceAll("-","+").replaceAll("_","/");
  const pad = (b64.length % 4) ? "=".repeat(4 - (b64.length % 4)) : "";
  const raw = atob(b64 + pad);
  const json = decodeURIComponent(escape(raw));
  return JSON.parse(json);
}

const codeIn = document.getElementById("codeIn");
const decodeBtn = document.getElementById("decodeBtn");
const clearBtn = document.getElementById("clearBtn");
const copyBtn = document.getElementById("copyBtn");
const out = document.getElementById("out");

function buildReport(p){
  const levelKey = p.levelKey || "LEVEL_1_BASE";
  const levelName = LEVEL_META[levelKey]?.name || levelKey;
  const score = Number(p.score || 0);
  const tier = (p.tier && p.tier.label) ? p.tier : tierFor(score);

  const telem = p.telem || {};
  const totalActiveMs = Number(telem.totalActiveMs || 0);
  const answerChanges = Number(telem.answerChanges || 0);

  const perQ = Array.isArray(telem.perQ) ? telem.perQ : [];
  const veryFast = perQ.filter(x => (x.ms||0) < 900).length;
  const avgMs = perQ.length ? Math.round(totalActiveMs / perQ.length) : 0;

  const lines = [];
  lines.push("AYA Questionnaire — Mentor Report");
  lines.push("------------------------------------------------------------");
  lines.push(`Level: ${levelName}`);
  lines.push(`Score: ${score} / 40`);
  lines.push(`Tier: ${tier.label} (${tier.min}–${tier.max})`);
  lines.push("");
  lines.push("Coaching Focus:");
  lines.push(`“${tier.focus}”`);
  lines.push("");
  lines.push("Integrity / Attention Signals");
  lines.push(`- Active time (approx): ${msToPretty(totalActiveMs)}`);
  lines.push(`- Avg time per question: ${avgMs ? msToPretty(avgMs) : "n/a"}`);
  lines.push(`- Answer changes: ${answerChanges}`);
  lines.push(`- Very-fast answers (<0.9s): ${veryFast} / ${perQ.length || 0}`);
  lines.push("");

  const qbank = LEVELS[levelKey] || [];
  const answers = p.answers || {};
  const orderKeys = Array.isArray(p.orderKeys) ? p.orderKeys : qbank.map(q=>q.key);

  lines.push("Responses");
  lines.push("------------------------------------------------------------");

  orderKeys.forEach((k, idx)=>{
    const q = qbank.find(x=>x.key===k) || qbank[idx] || {prompt:"(unknown question)", options:["","","",""]};
    const chosenText = answers[k] || "";
    const opts = q.options || ["","","",""];
    const pos = opts.indexOf(chosenText);
    const letter = (pos===0)?"A":(pos===1)?"B":(pos===2)?"C":(pos===3)?"D":"?";
    const pts = (pos>=0)? (pos+1) : "?";
    const ms = perQ.find(x=>x.key===k)?.ms;
    const t = (ms!=null) ? ` • ${msToPretty(ms)}` : "";

    lines.push(`Q${idx+1}. ${q.prompt}${t}`);
    if(letter==="?"){
      lines.push("  → (no answer)");
      lines.push("");
      return;
    }
    lines.push(`  → ${letter} (${pts} pt): ${chosenText}`);
    lines.push("");
  });

  return lines.join("\n");
}

decodeBtn.addEventListener("click", ()=>{
  const raw = (codeIn.value || "").trim();
  if(!raw){ alert("Paste a Result Code first."); return; }
  try{
    const payload = b64urlDecode(raw);
    out.textContent = buildReport(payload);
  }catch(e){
    console.error(e);
    alert("Couldn’t decode that code. Make sure you copied the whole Result Code.");
  }
});

clearBtn.addEventListener("click", ()=>{
  codeIn.value = "";
  out.textContent = "";
});

copyBtn.addEventListener("click", async ()=>{
  const txt = (out.textContent || "").trim();
  if(!txt){ alert("Nothing to copy yet."); return; }
  try{
    await navigator.clipboard.writeText(txt);
    alert("Copied report.");
  }catch(e){
    prompt("Copy report:", txt);
  }
});
</script>
</body>
</html>
